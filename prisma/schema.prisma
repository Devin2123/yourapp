datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  // If you hit a “shadow DB permission” error again, uncomment the next line and add SHADOW_DATABASE_URL in .env
  // shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Server {
  id              String    @id @default(cuid())
  guildId         String    @unique
  ownerDiscordId  String
  payoutWallet    String
  chain           String    @default("POLYGON")
  splitterAddress String
  createdAt       DateTime  @default(now())
  products        Product[]
  // orders Order[]  <-- remove this line
}

model Product {
  id          String   @id @default(cuid())
  serverId    String
  server      Server   @relation(fields: [serverId], references: [id])
  name        String
  description String?
  priceWei    String // store big ints as strings
  currency    String // "NATIVE" or token symbol
  chain       String   @default("POLYGON")
  roleId      String?
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  orders      Order[]
}

model Order {
  id             String   @id @default(cuid())
  productId      String
  product        Product  @relation(fields: [productId], references: [id])
  buyerDiscordId String?
  invoiceId      String?  @unique
  status         String   @default("PENDING") // PENDING | PAID | EXPIRED | CANCELED
  grossWei       String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}
